// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ReliabilityData {
  id                    Int      @id @default(autoincrement())
  make                  String
  model                 String
  yearStart             Int
  yearEnd               Int
  reliabilityScore      Decimal  @db.Decimal(3, 1)
  expectedLifespanMiles Int
  maintenanceCostRating MaintenanceRating
  partsAvailability     AvailabilityRating
}

model KnownIssue {
  id             Int           @id @default(autoincrement())
  make           String
  model          String
  year             Int? // Adjusting for schema issue? No, wait. 
  // User asked for yearStart, yearEnd.
  yearStart      Int
  yearEnd        Int
  issueName      String
  severity       IssueSeverity
  typicalMileage Int?
  repairCostLow  Int?
  repairCostHigh Int?
  description    String        @db.Text
}

model Analysis {
  id               Int            @id @default(autoincrement())
  vin              String?
  make             String
  model            String
  year             Int
  mileage          Int
  askingPrice      Decimal
  listingText      String?        @db.Text
  reliabilityScore Decimal
  longevityScore   Decimal
  priceScore       Decimal
  overallScore     Decimal
  recommendation   Recommendation
  redFlags         Json
  createdAt        DateTime       @default(now())
  userId           String?
  user             User?          @relation("UserAnalyses", fields: [userId], references: [id])
}

enum MaintenanceRating {
  LOW
  MEDIUM
  HIGH
}

enum AvailabilityRating {
  EXCELLENT
  GOOD
  FAIR
  POOR
}

enum IssueSeverity {
  MINOR
  MODERATE
  MAJOR
  CRITICAL
}

enum Recommendation {
  BUY
  MAYBE
  PASS
}

enum Plan {
  FREE
  PREMIUM
}

model User {
  id               String   @id @default(cuid())
  clerkId          String   @unique
  email            String   @unique
  plan             Plan     @default(FREE)
  stripeCustomerId String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  usageRecords UsageRecord[]
  analyses     Analysis[]    @relation("UserAnalyses")
}

model UsageRecord {
  id            String   @id @default(cuid())
  userId        String
  month         String   // "2026-01"
  analysisCount Int      @default(0)
  createdAt     DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@unique([userId, month])
}

model StripeEvent {
  id        String   @id @default(cuid())
  eventId   String   @unique
  type      String
  createdAt DateTime @default(now())
}
